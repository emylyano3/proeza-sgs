<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bootstrap HTML Test</title>
<link rel="stylesheet" href="../src/main/webapp/resources/bootstrap/css/bootstrap-theme.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../src/main/webapp/resources/bootstrap/css/bootstrap.css" type="text/css" media="screen" />
</head>
<body>
	<form id="formApi" >
		<label for="email">Email address</label> 
		<input type="email" class="form-control" name="email" id="email" placeholder="Enter email" />
		<label for="pass">Password</label> 
		<input type="password" class="form-control" id="pass" name="pass" placeholder="Password" />
		<label> 
			<input type="checkbox" id="check" name="check" /> Check me out
		</label>
		<p/>
		<label for="combo">Combo</label> 
		<select id="combo" name="combo" class="form-control input-md" required="required" autofocus="autofocus" >
			<option value="Option_1" selected="selected">Option 1</option>
			<option value="Option_2">Option 2</option>
		</select>
		<p/>
		<button id="submitCreate"  type="submit" class="btn btn-default">Submit</button>
	</form>
	<button id="openCreate" type="button" class="btn btn-default">Create</button>
	<button id="openEdit" type="button" class="btn btn-default">Edit</button>
	
	<script src="../src/main/webapp/resources/jquery/jquery.js"></script>
	<script src="../src/main/webapp/resources/jquery/jquery.inputmask.bundle.js"></script>
	<script src="../src/main/webapp/resources/bootstrap/js/bootstrap.js"></script>
	
	<script type="text/javascript">
		function loadEntityData(inputData, restUrl, errorMessage, setData) {
			$.ajax({
				type : 'POST',
				url : restUrl,
				dataType: 'json',
				contentType: 'application/json',
				data : inputData,
				success : function(data) {
					setData(data);
				},
				error : function(jqXHR, status) {
					$.notify({
						message: errorMessage
					},{
						type: 'danger'
					});
				}
			});
		}	

		function saveEntityData(data, restUrl, successMsg, callback) {
			$.ajax({
				type : 'POST',
				url : restUrl,
				dataType: 'json',
				contentType: 'application/json',
				data : JSON.stringify(data),
				success : function() {
					$.notify({
						message: successMsg
					},{
						type: 'success'
					});
					if (callback) {
						callback();
					}
				},
				error : function(jqXHR, status, errorThrown) {
					$.notify({
						message: JSON.parse(jqXHR.responseText).message
					},{
						type: 'danger'
					});
				}
			});
		}
				
		function chainCombo(srcCombo, targetCombo, serviceUrl, selectedValue, notifyCallback) {
			var code = $(srcCombo + ' option:selected').attr('value');
			var optDefault = $(targetCombo + ' option:first-child');
			if (!code) {
				$(targetCombo).empty();
				$(targetCombo).append(optDefault);
				return;
			}
			$.ajax({
				type : 'POST',
				url : serviceUrl,
				dataType: 'json',
				contentType: 'application/json',
				data : code,
				success : function(options) {
					$(targetCombo).empty();
					$(targetCombo).append(optDefault);
					$.each(options, function(index, option) {
						$(targetCombo).append(new Option(option.nombre, option.codigo));
					});
					if (selectedValue) {
						$(targetCombo).val(selectedValue);
					}
				},
				error: function () {
					if (notifyCallback) {
						notifyCallback();
					}
				}
			});
		}

		function emptyCombo (targetCombo, hasDefault) {
			var optDefault = $(targetCombo + ' option:first-child');
			$(targetCombo).empty();
			if (hasDefault && optDefault != null) {
				$(targetCombo).append(optDefault);
				$(targetCombo).val('');
			}
		}

		function initCombo(targetCombo, serviceUrl, notifyCallback) {
			var optDefault = $(targetCombo + ' option:first-child');
			$.ajax({
				type : 'POST',
				url : serviceUrl,
				dataType: 'json',
				contentType: 'application/json',
				success : function(options) {
					$(targetCombo).empty();
					$(targetCombo).append(optDefault);
					$.each(options, function(index, option) {
						$(targetCombo).append(new Option(option.nombre, option.codigo));
					});
				},
				error: function () {
					if (notifyCallback) {
						notifyCallback();
					}
				}
			});
		}
	</script>
	
	<script src="../src/main/webapp/resources/app/js/form-plugin.js"></script>
	
	<script type="text/javascript">
		var product = {
			rest : {
				getClasses : '/proeza-sgs/rest/product/getClasses',
				getTypes : '/proeza-sgs/rest/product/getTypes',
				createClass : '/proeza-sgs/rest/product/createClass',
				updateClass : '/proeza-sgs/rest/product/updateClass'
			}
		};
		$(document).ready(function() {
			$('#formApi')
				/* 
				 Si aplica, configuro la visibilidad / habilitacion de los campos del formulario para cada modo 
				 Ej: Para el modo 'modificacion' oculto el campo Codigo.
				 */
				.configField('create', 'pass', 'disabled')
				/*
				 Si aplica, configuro que componente "dispara" la apertura e inicializacion del formulario
				 Ej: Con el boton XXX el formulario se hace visible y se inicializa en modo 'Alta'
				 */
				.defaultMode('create')
				.configTrigger('create', 'openCreate')
				.configTrigger('update', 'openEdit')
				/*
				 Configura la accion cuando se hace el submit del formulario.
				 Ej: En el submit, se invoca el servicio rest XXX 
				 */
				.configSubmit('create', product.rest.createClass)
				.configSubmit('update', product.rest.updateClass)
				.fillCombo('fieldCombo', product.rest.getClasses)
				.chainCombo('fieldCombo', 'fieldCombo2', product.rest.getTypes);
		})
	</script>
</body>
</html>
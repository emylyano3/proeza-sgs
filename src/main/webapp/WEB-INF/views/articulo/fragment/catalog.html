<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<body>
	<!-- Command Bar -->
	<div th:fragment="commandBar" id="commandBar" role="group" class="btn-group commandbar-floating">
		
		<!-- Add Split button -->
		<div class="btn-group dropup">
			<button type="button" class="btn btn-success toolbar-button" id="newProduct" th:title="#{prod.add.tooltip}">
				<i class="fa fa-lg fa-plus"/>
			</button>
			<button type="button" class="btn btn-success dropdown-toggle toolbar-caret-button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<span class="caret"/> 
				<span class="sr-only"/>
			</button>
			<ul class="dropdown-menu">
				<li><a id="addCategory" th:text="#{control.category}" >Rubro</a></li>
				<li><a id="addClass" th:text="#{control.clazz}">Clase</a></li>
				<li><a id="addType" th:text="#{control.type}">Tipo</a></li>
				<li role="separator" class="divider"></li>
				<li><a id="addBrand" th:text="#{control.brand}">Marca</a></li>
			</ul>
		</div>

		<!-- Edit Single button -->
		<div class="btn-group dropup">
			<button type="button" class="btn btn-warning toolbar-button dropdown-toggle" id="edit" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<i class="fa fa-lg fa-edit"/>
			</button>
			<ul class="dropdown-menu dropdown-menu-right" >
				<li><a id="editCategory" th:text="#{control.category}">Rubro</a></li>
				<li><a id="editClass" th:text="#{control.clazz}">Clase</a></li>
				<li><a id="editType" th:text="#{control.type}">Tipo</a></li>
				<li role="separator" class="divider"></li>
				<li><a id="editBrand" th:text="#{control.brand}">Marca</a></li>
			</ul>
		</div>

		<!-- Delete Single button -->
		<div class="btn-group dropup">
			<button type="button" class="btn btn-danger toolbar-button dropdown-toggle" id="delete" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				<i class="fa fa-lg fa-remove"/>
			</button>
			<ul class="dropdown-menu dropdown-menu-right">
				<li><a id="deleteCategory" th:text="#{control.category}">Rubro</a></li>
				<li><a id="deleteClass" th:text="#{control.clazz}">Clase</a></li>
				<li><a id="deleteType" th:text="#{control.type}">Tipo</a></li>
				<li role="separator" class="divider"></li>
				<li><a id="deleteBrand" th:text="#{control.brand}">Marca</a></li>
			</ul>
		</div>
	</div>
	
    <!-- Modal de edicion maestros de articulo -->
	<div th:fragment="catalogEditor">
		<div class="modal fade" id="brandModalPopup" tabindex="-1" role="dialog" aria-hidden="true" >
			<div class="modal-dialog">
				<div class="color-line" />
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<div class="modal-title">
							<span id="mpBraTitle"/>
						</div>
					</div>
					<form id="mpBraForm" class="form-horizontal" method="post">
						<div class="modal-body">
							<div class="row">
								<div class="col-md-1" />
								<div class="col-md-10" >
									<div class="form-group">
										<label id="mpBraBrandFilterLabel" for="mpBraBrandFilter" class="control-label" th:text="#{control.brand}" />
										<select id="mpBraBrandFilter" class="form-control input-md" required="required" autofocus="autofocus" >
											<option value="" th:text="#{control.choose}"/>
											<option th:each="marca : ${marcas}" th:text="${marca.nombre}" th:value="${marca.codigo}" />
										</select>
									</div>
									<hr id="mpBraInputDivider" />
									<div class="form-group">
										<label for="mpBraName" class="control-label" th:text="#{control.name}" >Nombre</label>
										<input id="mpBraName" class="form-control" type="text" required="required" maxlength="50"/>
									</div>
									<div class="form-group">
										<label for="mpBraDesc" class="control-label" th:text="#{control.description}">Descripción</label>
										<input id="mpBraDesc" class="form-control" type="text" maxlength="100" />
									</div>
								</div>
								<div class="col-md-1" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{control.close}" />
							<button id="mpBraSave" type="submit" class="btn btn-primary" />
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="modal fade" id="categoryModalPopup" tabindex="-1" role="dialog" aria-hidden="true" >
			<div class="modal-dialog">
				<div class="color-line" />
				<div class="modal-content">
					<div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">&times;</span>
	                    </button>
	                    <div class="modal-title">
	                        <span id="mpCatTitle"/>
	                    </div>
	                </div>
					<form id="mpCatForm" class="form-horizontal" method="post">
						<div class="modal-body">
							<div class="row">
								<div class="col-md-1" />
								<div class="col-md-10" >
									<div class="form-group">
										<label id="mpCatCategoryFilterLabel" for="mpCatCategoryFilter" class="control-label" th:text="#{control.category}" />
	                                    <select id="mpCatCategoryFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                        <option th:each="rubro : ${rubros}" th:text="${rubro.nombre}" th:value="${rubro.codigo}" />
	                                    </select>
									</div>
									<hr id="mpCatInputDivider" />
									<div class="form-group">
										<label for="mpCatName" class="control-label" th:text="#{control.name}" >Nombre</label>
										<input id="mpCatName" class="form-control" type="text" required="required" maxlength="50"/>
									</div>
									<div class="form-group">
										<label for="mpCatDesc" class="control-label" th:text="#{control.description}">Descripción</label>
										<input id="mpCatDesc" class="form-control" type="text" maxlength="100" />
									</div>
								</div>
								<div class="col-md-1" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{control.close}" />
							<button id="mpCatSave" type="submit" class="btn btn-primary" />
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="modal fade" id="classModalPopup" tabindex="-1" role="dialog" aria-hidden="true" >
			<div class="modal-dialog">
				<div class="color-line" />
				<div class="modal-content">
					<div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">&times;</span>
	                    </button>
	                    <div class="modal-title">
	                        <span id="mpClaTitle"/>
	                    </div>
	                </div>
					<form id="mpClaForm" class="form-horizontal" method="post">
						<div class="modal-body">
							<div class="row">
								<div class="col-md-1" />
								<div class="col-md-10" >
									<div class="form-group">
										<label id="mpClaCatFilterLabel" for="mpClaCatFilter" class="control-label" th:text="#{control.category}" />
	                                    <select id="mpClaCatFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                        <option th:each="rubro : ${rubros}" th:text="${rubro.nombre}" th:value="${rubro.codigo}" />
	                                    </select>
									</div>
									<div class="form-group">
										<label id="mpClaClassFilterLabel" for="mpClaClassFilter" class="control-label" th:text="#{control.clazz}" />
	                                    <select id="mpClaClassFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                    </select>
									</div>
									<hr id="mpClaInputDivider" />
									<div class="form-group">
										<label for="mpClaName" class="control-label" th:text="#{control.name}" >Nombre</label>
										<input id="mpClaName" class="form-control" type="text" required="required" maxlength="50"/>
									</div>
									<div class="form-group">
										<label for="mpClaDesc" class="control-label" th:text="#{control.description}">Descripción</label>
										<input id="mpClaDesc" class="form-control" type="text" maxlength="100" />
									</div>
									<div class="form-group">
										<label for="mpClaCatInput" class="control-label" th:text="#{control.category}" />
	                                    <select id="mpClaCatInput" class="form-control input-md" required="required" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                        <option th:each="rubro : ${rubros}" th:text="${rubro.nombre}" th:value="${rubro.codigo}" />
	                                    </select>
									</div>
								</div>
								<div class="col-md-1" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{control.close}" />
							<button id="mpClaSave" type="submit" class="btn btn-primary" />
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="modal fade" id="typeModalPopup" tabindex="-1" role="dialog" aria-hidden="true" >
			<div class="modal-dialog">
				<div class="color-line" />
				<div class="modal-content">
					<div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">&times;</span>
	                    </button>
	                    <div class="modal-title">
	                        <span id="mpTypTitle"/>
	                    </div>
	                </div>
					<form id="mpTypForm" class="form-horizontal" method="post">
						<div class="modal-body">
							<div class="row">
								<div class="col-md-1" />
								<div class="col-md-10" >
									<div class="form-group">
										<label id="mpTypCatFilterLabel" for="mpTypCatFilter" class="control-label" th:text="#{control.category}" />
	                                    <select id="mpTypCatFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                        <option th:each="rubro : ${rubros}" th:text="${rubro.nombre}" th:value="${rubro.codigo}" />
	                                    </select>
									</div>
									<div class="form-group">
										<label id="mpTypClassFilterLabel" for="mpTypClassFilter" class="control-label" th:text="#{control.clazz}" />
	                                    <select id="mpTypClassFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                    </select>
									</div>
									<div class="form-group">
										<label id="mpTypTypeFilterLabel" for="mpTypTypeFilter" class="control-label" th:text="#{control.type}" />
	                                    <select id="mpTypTypeFilter" class="form-control input-md" required="required" autofocus="autofocus" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                    </select>
									</div>
									<hr id="mpTypInputDivider" />
									<div class="form-group">
										<label for="mpTypName" class="control-label" th:text="#{control.name}" >Nombre</label>
										<input id="mpTypName" class="form-control" type="text" required="required" maxlength="50"/>
									</div>
									<div class="form-group">
										<label for="mpTypDesc" class="control-label" th:text="#{control.description}">Descripción</label>
										<input id="mpTypDesc" class="form-control" type="text" maxlength="100" />
									</div>
									<div class="form-group">
										<label for="mpTypCatInput" class="control-label" th:text="#{control.category}" />
	                                    <select id="mpTypCatInput" class="form-control input-md" required="required" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                        <option th:each="rubro : ${rubros}" th:text="${rubro.nombre}" th:value="${rubro.codigo}" />
	                                    </select>
									</div>
									<div class="form-group">
										<label for="mpTypClassInput" class="control-label" th:text="#{control.clazz}" />
	                                    <select id="mpTypClassInput" class="form-control input-md" required="required" >
	                                        <option value="" th:text="#{control.choose}"/>
	                                    </select>
									</div>
								</div>
								<div class="col-md-1" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{control.close}" />
							<button id="mpTypSave" type="submit" class="btn btn-primary" />
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div th:fragment="catalogScript" >
		<script th:inline="javascript">
			 /*<![CDATA[*/
			$(document).ready(function() {
				initClassForm();
				initCategoryForm();
				initTypeForm();
				initBrandForm();
			})
			
			// Administracion de marca
			
			function initBrandForm() {
				$('#addBrand').click(function() {
					$('#mpBraForm').attr('action', 'create')
					cleanBrandForm();
					setBrandFormForCreate();
					$('#brandModalPopup').modal('show');
				});
				$('#deleteBrand').click(function(){
					$('#mpBraForm').attr('action', 'delete')
					cleanBrandForm();
					setBrandFormForDelete();
					$('#brandModalPopup').modal('show');
				});
				$('#editBrand').click(function(){
					$('#mpBraForm').attr('action', 'edit')
					cleanBrandForm();
					setBrandFormForUpdate();
					$('#brandModalPopup').modal('show');
				});
				$('#mpBraBrandFilter').change(function(e) {
					if ($('#mpBraBrandFilter')[0].selectedIndex > 0) {
						loadEntityData($(this).val(), product.rest.brandByCode, setBrandData);	
					} else {
						cleanBrandForm();
					}
				});
				$('#mpBraForm').submit(function(e) {
					e.preventDefault();
					var action = $(this).attr('action');
					var actionUrl, actionSuccessMsg, doAction = true;
					switch (action) {
					case 'create':
						actionUrl =	product.rest.addBrand;
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'edit':
						actionUrl =	product.rest.updateBrand; 
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'delete':
						swal({
								title: [[#{control.confirmDelete.title}]],
								text: [[#{prod.brand.confirmDelete.message}]] + ' ' + $('#mpBraBrandFilter option:selected').text(),
								type: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#DD6B55',
								confirmButtonText: [[#{control.confirmDelete}]],
								cancelButtonText: [[#{control.cancelDelete}]]
							}, 
							function (isConfirm) {
								if (isConfirm) {
									saveEntityData(
										getBrandFormData(), 
										product.rest.deleteBrand, 
										[[#{rest.datasend.success}]],
										updateBrandCombos
									);
									cleanBrandForm();
								}
								$('#brandModalPopup').modal('show');
							}
						);
					default:
						doAction = false;
						break;
					}
					if (doAction) {
						saveEntityData(
							getBrandFormData(), 
							actionUrl, 
							actionSuccessMsg,
							updateBrandCombos
						);
					}
					$('#brandModalPopup').modal('hide');
				});
			}
			 
			function updateBrandCombos () {
				initCombo('#mpBraBrandFilter', product.rest.getBrands);
				initCombo('#cbMarca', product.rest.getBrands);
			}
			
			function setBrandFormForCreate () {
				disableBrandInput(false);
				$('#mpBraBrandFilterLabel').hide();
				$('#mpBraBrandFilter').hide();
				$('#mpBraBrandFilter').prop('disabled', true);
				$('#mpBraInputDivider').hide();
				$('#mpBraTitle').text([[#{prod.brand.addPopupTitle}]]);
				$('#mpBraSave').text([[#{control.save}]]);	
			}

			function setBrandFormForDelete () {
				disableBrandInput(true);
				$('#mpBraBrandFilterLabel').show();
				$('#mpBraBrandFilter').show();
				$('#mpBraBrandFilter').prop('disabled', false);
				$('#mpBraInputDivider').show();
				$('#mpBraTitle').text([[#{prod.brand.deletePopupTitle}]]);
				$('#mpBraSave').text([[#{control.remove}]]);
			}

			function setBrandFormForUpdate () {
				disableBrandInput(false);
				$('#mpBraBrandFilterLabel').show();
				$('#mpBraBrandFilter').show();
				$('#mpBraBrandFilter').prop('disabled', false);
				$('#mpBraInputDivider').show();
				$('#mpBraTitle').text([[#{prod.brand.editPopupTitle}]]);
				$('#mpBraSave').text([[#{control.save}]]);	
			}
			
			function cleanBrandForm () {
				$('#mpBraName').val('');
				$('#mpBraDesc').val('');
				$('#mpBraBrandFilter').val('');	
			}
			
			function disableBrandInput (value) {
				$('#mpBraName').prop('disabled', value);
				$('#mpBraDesc').prop('disabled', value);
			}
			
			function getBrandFormData () {
				var data = {
					codigo : $('#mpBraBrandFilter').val(),
					nombre : $('#mpBraName').val(),
					descripcion : $('#mpBraDesc').val()
				};
				return data;
			}
			
			function setBrandData (data) {
				$('#mpBraName').val(data.nombre);
				$('#mpBraDesc').val(data.descripcion);
			}
			 
			// Administracion de categoria 
			
			function initCategoryForm() {
				$('#addCategory').click(function() {
					$('#mpCatForm').attr('action', 'create')
					cleanCategoryForm();
					setCategoryFormForCreate();
					$('#categoryModalPopup').modal('show');
				});
				$('#deleteCategory').click(function(){
					$('#mpCatForm').attr('action', 'delete')
					cleanCategoryForm();
					setCategoryFormForDelete();
					$('#categoryModalPopup').modal('show');
				});
				$('#editCategory').click(function(){
					$('#mpCatForm').attr('action', 'edit')
					cleanCategoryForm();
					setCategoryFormForUpdate();
					$('#categoryModalPopup').modal('show');
				});
				$('#mpCatCategoryFilter').change(function(e) {
					if ($('#mpCatCategoryFilter')[0].selectedIndex > 0) {
						loadEntityData($(this).val(), product.rest.categoryByCode, setCategoryData);	
					} else {
						cleanCategoryForm();
					}
				});
				$('#mpCatForm').submit(function(e) {
					e.preventDefault();
					var action = $(this).attr('action');
					var actionUrl, actionSuccessMsg, doAction = true;
					switch (action) {
					case 'create':
						actionUrl =	product.rest.addCategory;
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'edit':
						actionUrl =	product.rest.updateCategory; 
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'delete':
						swal({
								title: [[#{control.confirmDelete.title}]],
								text: [[#{prod.category.confirmDelete.message}]] + ' ' + $('#mpCatCategoryFilter option:selected').text(),
								type: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#DD6B55',
								confirmButtonText: [[#{control.confirmDelete}]],
								cancelButtonText: [[#{control.cancelDelete}]]
							}, 
							function (isConfirm) {
								if (isConfirm) {
									saveEntityData(
										getCategoryFormData(), 
										product.rest.deleteCategory, 
										[[#{rest.datasend.success}]],
										updateCategoryCombos
									);
									cleanCategoryForm();
								}
								$('#categoryModalPopup').modal('show');
							}
						);
					default:
						doAction = false;
						break;
					}
					if (doAction) {
						saveEntityData(
							getCategoryFormData(), 
							actionUrl, 
							actionSuccessMsg,
							updateCategoryCombos
						);
					}
					$('#categoryModalPopup').modal('hide');
				});
			}
			
			function updateCategoryCombos () {
				initCombo('#mpCatCategoryFilter', product.rest.getCategories);
				initCombo('#mpClaCatFilter', product.rest.getCategories);
				initCombo('#mpClaCatInput', product.rest.getCategories);
				initCombo('#mpTypCatFilter', product.rest.getCategories);
				initCombo('#mpTypCatInput', product.rest.getCategories);
				initCombo('#cbRubro', product.rest.getCategories);
				cleanCategoryForm();
			}
			
			function setCategoryFormForCreate () {
				disableCategoryInput(false);
				$('#mpCatCategoryFilterLabel').hide();
				$('#mpCatCategoryFilter').hide();
				$('#mpCatInputDivider').hide();
				$('#mpCatCategoryFilter').prop('disabled', true);
				$('#mpCatTitle').text([[#{prod.category.addPopupTitle}]]);
				$('#mpCatSave').text([[#{control.save}]]);	
			}

			function setCategoryFormForDelete () {
				disableCategoryInput(true);
				$('#mpCatCategoryFilterLabel').show();
				$('#mpCatCategoryFilter').show();
				$('#mpCatCategoryFilter').prop('disabled', false);
				$('#mpCatInputDivider').show();
				$('#mpCatTitle').text([[#{prod.category.deletePopupTitle}]]);
				$('#mpCatSave').text([[#{control.remove}]]);
			}

			function setCategoryFormForUpdate () {
				disableCategoryInput(false);
				$('#mpCatCategoryFilterLabel').show();
				$('#mpCatCategoryFilter').show();
				$('#mpCatCategoryFilter').prop('disabled', false);
				$('#mpCatInputDivider').show();
				$('#mpCatTitle').text([[#{prod.category.editPopupTitle}]]);
				$('#mpCatSave').text([[#{control.save}]]);	
			}
			
			function cleanCategoryForm () {
				$('#mpCatName').val('');
				$('#mpCatDesc').val('');
				$('#mpCatCategoryFilter').val('');	
			}
			
			function disableCategoryInput (value) {
				$('#mpCatName').prop('disabled', value);
				$('#mpCatDesc').prop('disabled', value);
			}
			
			function getCategoryFormData () {
				var data = {
					codigo : $('#mpCatCategoryFilter').val(),
					nombre : $('#mpCatName').val(),
					descripcion : $('#mpCatDesc').val()
				};
				return data;
			}
			
			function setCategoryData (data) {
				$('#mpCatName').val(data.nombre);
				$('#mpCatDesc').val(data.descripcion);
			}
			
			// Administracion de clase
			
			function initClassForm() {
				$('#addClass').click(function() {
					$('#mpClaForm').attr('action', 'create')
					cleanClassForm();
					setClassFormForCreate();
					$('#classModalPopup').modal('show');
				});
				$('#deleteClass').click(function(){
					$('#mpClaForm').attr('action', 'delete')
					cleanClassForm();
					setClassFormForDelete();
					$('#classModalPopup').modal('show');
				});
				$('#editClass').click(function(){
					$('#mpClaForm').attr('action', 'edit')
					cleanClassForm();
					setClassFormForUpdate();
					$('#classModalPopup').modal('show');
				});
				$('#mpClaCatFilter').change(function(e) {
					chainCombo('#mpClaCatFilter', '#mpClaClassFilter', product.rest.classesByCategory);
				});
				$('#mpClaClassFilter').change(function(e) {
					if ($('#mpClaClassFilter')[0].selectedIndex > 0) {
						loadEntityData($(this).val(), product.rest.classByCode, setClassData);	
					} else {
						cleanClassForm();
					}
				});
				$('#mpClaForm').submit(function(e) {
					e.preventDefault();
					var action = $(this).attr('action');
					var actionUrl, actionSuccessMsg, doAction = true;
					switch (action) {
					case 'create':
						actionUrl =	product.rest.addClass;
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'edit':
						actionUrl =	product.rest.updateClass; 
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'delete':
						swal({
								title: [[#{control.confirmDelete.title}]],
								text: [[#{prod.clazz.confirmDelete.message}]] + ' ' + $('#mpClaClassFilter option:selected').text(),
								type: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#DD6B55',
								confirmButtonText: [[#{control.confirmDelete}]],
								cancelButtonText: [[#{control.cancelDelete}]]
							}, 
							function (isConfirm) {
								if (isConfirm) {
									saveEntityData(
										getClassFormData(), 
										product.rest.deleteClass, 
										[[#{rest.datasend.success}]],
										updateClassCombos
									);
									cleanClassForm();
								} 
								$('#classModalPopup').modal('show');
							}
						);
					default:
						doAction = false;
						break;
					}
					if (doAction) {
						saveEntityData(
							getClassFormData(), 
							actionUrl, 
							actionSuccessMsg,
							updateClassCombos
						);
					}
					$('#classModalPopup').modal('hide');
				});
			}

			function updateClassCombos () {
				initCombo('#mpClaClassFilter', product.rest.getClasses);
				initCombo('#mpTypClassFilter', product.rest.getClasses);
				initCombo('#mpTypClassInput', product.rest.getClasses);
				cleanClassForm();
			}
			
			function setClassFormForCreate () {
				disableClassInput(false);
				$('#mpClaClassFilterLabel').hide();
				$('#mpClaClassFilter').hide();
				$('#mpClaClassFilter').prop('disabled', true); // Se deshabilita para que no se valide en el formulario
				$('#mpClaCatFilterLabel').hide();
				$('#mpClaCatFilter').hide();
				$('#mpClaInputDivider').hide();
				$('#mpClaCatFilter').prop('disabled', true); // Se deshabilita para que no se valide en el formulario
				$('#mpClaTitle').text([[#{prod.clazz.addPopupTitle}]]);
				$('#mpClaSave').text([[#{control.save}]]);	
			}

			function setClassFormForDelete () {
				disableClassInput(true);
				$('#mpClaClassFilterLabel').show();
				$('#mpClaClassFilter').show();
				$('#mpClaClassFilter').prop('disabled', false);
				$('#mpClaCatFilterLabel').show();
				$('#mpClaCatFilter').show();
				$('#mpClaInputDivider').show();
				$('#mpClaCatFilter').prop('disabled', false);
				$('#mpClaTitle').text([[#{prod.clazz.deletePopupTitle}]]);
				$('#mpClaSave').text([[#{control.remove}]]);
			}

			function setClassFormForUpdate () {
				disableClassInput(false);
				$('#mpClaClassFilterLabel').show();
				$('#mpClaClassFilter').show();
				$('#mpClaClassFilter').prop('disabled', false);
				$('#mpClaCatFilterLabel').show();
				$('#mpClaCatFilter').show();
				$('#mpClaCatFilter').prop('disabled', false);
				$('#mpClaInputDivider').show();
				$('#mpClaTitle').text([[#{prod.clazz.editPopupTitle}]]);
				$('#mpClaSave').text([[#{control.save}]]);	
			}
			
			function cleanClassForm () {
				$('#mpClaName').val('');
				$('#mpClaDesc').val('');
				$('#mpClaCatFilter').val('');
				$('#mpClaCatInput').val('');
				$('#mpClaClassFilter').val('');	
			}
			
			function disableClassInput (value) {
				$('#mpClaName').prop('disabled', value);
				$('#mpClaDesc').prop('disabled', value);
				$('#mpClaCatInput').prop('disabled', value);
			}
			
			function getClassFormData () {
				var data = {
					codigo : $('#mpClaClassFilter').val(),
					nombre : $('#mpClaName').val(),
					descripcion : $('#mpClaDesc').val(),
					codRubro :$('#mpClaCatInput').val()
				};
				return data;
			}
			
			function setClassData (data) {
				$('#mpClaName').val(data.nombre);
				$('#mpClaDesc').val(data.descripcion);
				$('#mpClaCatInput').val(data.codRubro);
			}

			// Administracion de tipo
			
			function initTypeForm() {
				$('#addType').click(function() {
					$('#mpTypForm').attr('action', 'create')
					resetTypeForm();
					setTypeFormForCreate();
					$('#typeModalPopup').modal('show');
				});
				$('#deleteType').click(function(){
					$('#mpTypForm').attr('action', 'delete')
					resetTypeForm();
					setTypeFormForDelete();
					$('#typeModalPopup').modal('show');
				});
				$('#editType').click(function(){
					$('#mpTypForm').attr('action', 'edit')
					resetTypeForm();
					setTypeFormForUpdate();
					$('#typeModalPopup').modal('show');
				});
				$('#mpTypCatInput').change(function(e) {
					chainCombo('#mpTypCatInput', '#mpTypClassInput', product.rest.classesByCategory);
				});
				$('#mpTypCatFilter').change(function(e) {
					chainCombo('#mpTypCatFilter', '#mpTypClassFilter', product.rest.classesByCategory);
				});
				$('#mpTypClassFilter').change(function(e) {
					chainCombo('#mpTypClassFilter', '#mpTypTypeFilter', product.rest.typesByClass);
				});
				$('#mpTypTypeFilter').change(function(e) {
					if ($('#mpTypTypeFilter')[0].selectedIndex > 0) {
						loadEntityData($(this).val(), product.rest.typeByCode, setTypeData);	
					} else {
						cleanTypeFormInput();
					}
				});
				$('#mpTypForm').submit(function(e) {
					e.preventDefault();
					var action = $(this).attr('action');
					var actionUrl, actionSuccessMsg, doAction = true;
					switch (action) {
					case 'create':
						actionUrl =	product.rest.addType;
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'edit':
						actionUrl =	product.rest.updateType; 
						actionSuccessMsg = [[#{rest.datasend.success}]];
						break;
					case 'delete':
						swal({
								title: [[#{control.confirmDelete.title}]],
								text: [[#{prod.type.confirmDelete.message}]] + ' ' + $('#mpTypTypeFilter option:selected').text(),
								type: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#DD6B55',
								confirmButtonText: [[#{control.confirmDelete}]],
								cancelButtonText: [[#{control.cancelDelete}]]
							}, 
							function (isConfirm) {
								if (isConfirm) {
									saveEntityData(
										getTypeFormData(), 
										product.rest.deleteType, 
										[[#{rest.datasend.success}]],
										updateTypeCombos
									);
									resetTypeForm();
								} 
								$('#typeModalPopup').modal('show');
							}
						);
					default:
						doAction = false;
						break;
					}
					if (doAction) {
						saveEntityData(
							getTypeFormData(), 
							actionUrl, 
							actionSuccessMsg,
							updateTypeCombos
						);
					}
					$('#typeModalPopup').modal('hide');
				});
			}

			function updateTypeCombos () {
				initCombo('#mpTypTypeFilter', product.rest.getTypes);
			}
			
			function setTypeFormForCreate () {
				disableTypeInput(false);
				$('#mpTypCatFilterLabel').hide();
				$('#mpTypCatFilter').hide();
				$('#mpTypCatFilter').prop('disabled', true); // Se deshabilita para que no se valide en el formulario
				$('#mpTypClassFilterLabel').hide();
				$('#mpTypClassFilter').hide();
				$('#mpTypClassFilter').prop('disabled', true); // Se deshabilita para que no se valide en el formulario
				$('#mpTypTypeFilterLabel').hide();
				$('#mpTypTypeFilter').hide();
				$('#mpTypTypeFilter').prop('disabled', true); // Se deshabilita para que no se valide en el formulario
				$('#mpTypInputDivider').hide();
				$('#mpTypTitle').text([[#{prod.type.addPopupTitle}]]);
				$('#mpTypSave').text([[#{control.save}]]);	
			}

			function setTypeFormForDelete () {
				disableTypeInput(true);
				$('#mpTypCatFilterLabel').show();
				$('#mpTypCatFilter').show();
				$('#mpTypCatFilter').prop('disabled', false);				
				$('#mpTypClassFilterLabel').show();
				$('#mpTypClassFilter').show();
				$('#mpTypClassFilter').prop('disabled', false);
				$('#mpTypTypeFilterLabel').show();
				$('#mpTypTypeFilter').show();
				$('#mpTypTypeFilter').prop('disabled', false);
				$('#mpTypInputDivider').show();
				$('#mpTypTitle').text([[#{prod.type.deletePopupTitle}]]);
				$('#mpTypSave').text([[#{control.remove}]]);
			}

			function setTypeFormForUpdate () {
				disableTypeInput(false);
				$('#mpTypCatFilterLabel').show();
				$('#mpTypCatFilter').show();
				$('#mpTypCatFilter').prop('disabled', false);				
				$('#mpTypClassFilterLabel').show();
				$('#mpTypClassFilter').show();
				$('#mpTypClassFilter').prop('disabled', false);
				$('#mpTypTypeFilterLabel').show();
				$('#mpTypTypeFilter').show();
				$('#mpTypTypeFilter').prop('disabled', false);
				$('#mpTypInputDivider').show();
				$('#mpTypTitle').text([[#{prod.type.editPopupTitle}]]);
				$('#mpTypSave').text([[#{control.save}]]);	
			}
			
			function resetTypeForm () {
				$('#mpTypName').val('');
				$('#mpTypDesc').val('');
				$('#mpTypCatFilter').val('');
				$('#mpTypCatInput').val('');	
				emptyCombo('#mpTypClassFilter', true);
				emptyCombo('#mpTypClassInput', true);
				emptyCombo('#mpTypTypeFilter', true);
			}
			
			function cleanTypeFormInput () {
				$('#mpTypName').val('');
				$('#mpTypDesc').val('');
				$('#mpTypCatInput').val('');
				$('#mpTypClassInput').val('');
			}
			
			function disableTypeInput (value) {
				$('#mpTypName').prop('disabled', value);
				$('#mpTypDesc').prop('disabled', value);
				$('#mpTypCatInput').prop('disabled', value);
				$('#mpTypClassInput').prop('disabled', value);
			}
			
			function getTypeFormData () {
				var data = {
					codigo : $('#mpTypTypeFilter').val(),
					nombre : $('#mpTypName').val(),
					descripcion : $('#mpTypDesc').val(),
					codClase :$('#mpTypClassInput').val()
				};
				return data;
			}
			
			function setTypeData (data) {
				$('#mpTypName').val(data.nombre);
				$('#mpTypDesc').val(data.descripcion);
				$('#mpTypCatInput').val(data.codRubro);
				chainCombo(
						'#mpTypCatInput', 
						'#mpTypClassInput', 
						product.rest.classesByCategory, 
						data.codClase
				);
			}
			
			function loadEntityData(inputData, restUrl, setData) {
				$.ajax({
					type : 'POST',
					url : restUrl,
					dataType: 'json',
					contentType: 'application/json',
					data : inputData,
					success : function(data) {
						setData(data);
					},
					error : function(jqXHR, status) {
						$.notify({
							message: [[#{rest.dataload.error}]]
						},{
							type: 'danger'
						});
					}
				});
			}	

			function saveEntityData(data, restUrl, successMsg, callback) {
				$.ajax({
					type : 'POST',
					url : restUrl,
					dataType: 'json',
					contentType: 'application/json',
					data : JSON.stringify(data),
					success : function() {
						$.notify({
							message: successMsg
						},{
							type: 'success'
						});
						if (callback) {
							callback();
						}
					},
					error : function(jqXHR, status) {
						$.notify({
							message: [[#{rest.datasend.error}]]
						},{
							type: 'danger'
						});
					}
				});
			}
			/*]]>*/
		</script>
	</div>
</body>
</html>